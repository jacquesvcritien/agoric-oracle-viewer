(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8875:function(e,s,r){Promise.resolve().then(r.bind(r,6301))},6301:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return k}});var t=r(7437),a=JSON.parse('{"rpc":"https://main.rpc.agoric.net:443","oracleAddresses":{"agoric1krunjcqfrf7la48zrvdfeeqtls5r00ep68mzkr":{"oracleName":"Simply Staking"},"agoric144rrhh4m09mh7aaffhm6xy223ym76gve2x7y78":{"oracleName":"DSRV"},"agoric19d6gnr9fyp6hev4tlrg87zjrzsd5gzr5qlfq2p":{"oracleName":"Stakin"},"agoric1n4fcxsnkxe4gj6e24naec99hzmc4pjfdccy5nj":{"oracleName":"P2P"},"agoric19uscwxdac6cf6z7d5e26e0jm0lgwstc47cpll8":{"oracleName":"01node"}}}'),l=r(2265),n=r(5422),i=r(1328),c=r(2053),o=r(8382),d=r(9100),u=r(7022),p=r(1161),m=r(5319);let h=async(e,s)=>{try{let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw Error("HTTP error! Status: ".concat(r.status));return await r.json()}catch(e){throw console.error("Error:",e),e}},f=async e=>{try{let s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw Error("HTTP error! Status: ".concat(s.status));return await s.json()}catch(e){throw console.error("Error:",e),e}},x=e=>{let s=Object.entries(e);return s.sort((e,s)=>e[1].unitPrice-s[1].unitPrice),Object.fromEntries(s)},N=e=>0!=e.result.response.code?(console.log("Query Errored"),null):JSON.parse(atob(e.result.response.value)),j=e=>{if(!(e=N(e)))return null;let s=e.children.map(e=>e.split("_")[0]),r={};for(let e of s)r[e]={round:0,startedBy:"",startedAt:0,price:0,amountIn:0};let t={};for(let e in a.oracleAddresses)for(let r of(t[e]={},s))t[e][r]="";return{feeds:r,oracleInvitations:t}},b=e=>e.startsWith("#")?JSON.parse(e.substring(1,e.length)):null,g=e=>{if(!(e=N(e)))return null;let s=JSON.parse(e.value).values,r={};for(let e of s){let s=b((e=JSON.parse(e)).body),t=e.slots;if(s)for(let e of s)e[0].includes("price feed")&&(r[t[Number(e[1].split(".")[0].substring(1))]]=e[0])}return r},v=(e,s,r)=>{if(!(e=N(e)))return r;for(let t of JSON.parse(e.value).values){let e=b((t=JSON.parse(t)).body);e&&(r[s]={round:Number(e.roundId.substring(1,e.roundId.length)),startedAt:Number(e.startedAt.absValue.substring(1,e.startedAt.absValue.length)),startedBy:e.startedBy,price:0,amountIn:0})}return r},y=(e,s,r)=>{if(!(e=N(e)))return r;for(let t of JSON.parse(e.value).values){let e=b((t=JSON.parse(t)).body);if(e){let t=Number(e.amountIn.value.substring(1,e.amountIn.value.length)),a=Number(e.amountOut.value.substring(1,e.amountOut.value.length));r[s].price=a/t,r[s].amountIn=t}}return r},S=(e,s,r,t,a,l)=>{if(!(e=N(e)))return{oracleInvitations:a,submission:null};for(let n of JSON.parse(e.value).values){let e=(n=JSON.parse(n)).slots,i=b(n.body);if(i){let n=i.offerToUsedInvitation;if(""==a[s][r]){for(let t of n)if(l[e[Number(t[1].value[0].instance.split(".")[0].substring(1))]].startsWith(r)){let e=Number(a[s][r].split("oracleAccept-")[1]),l=Number(t[0].split("oracleAccept-")[1]);(""==a[s][r]||l>e)&&(a[s][r]=t[0])}}for(let e of i.liveOffers)if("PushPrice"==e[1].invitationSpec.invitationMakerName){e[1].id;let l={roundId:e[1].invitationSpec.invitationArgs[0].roundId,unitPrice:Number(e[1].invitationSpec.invitationArgs[0].unitPrice)/t[r].amountIn};if(e[1].invitationSpec.previousOffer==a[s][r])return{oracleInvitations:a,submission:l}}}}return{oracleInvitations:a,submission:null}};var O=r(3055),w=r(884),I=r(5448);function k(){let[e,s]=(0,l.useState)({}),[r,N]=(0,l.useState)({}),[b,k]=(0,l.useState)({}),[A,P]=(0,l.useState)(""),[_,E]=(0,l.useState)(""),[J,T]=(0,l.useState)({}),[q,z]=(0,l.useState)("");(0,l.useEffect)(()=>{P("Getting data"),E("Please wait while we fetch the initial data");let e=a.rpc,r={jsonrpc:"2.0",id:1,method:"abci_query",params:{path:"/custom/vstorage/children/published.priceFeed"}};h(e,r).then(e=>{let r=j(e);r&&(T(null==r?void 0:r.oracleInvitations),s(null==r?void 0:r.feeds),console.log("Feeds",null==r?void 0:r.feeds))}).catch(e=>console.error("Error:",e)),h(e,r={jsonrpc:"2.0",id:1,method:"abci_query",params:{path:"/custom/vstorage/data/published.agoricNames.instance"}}).then(e=>{k(g(e)),P("")}).catch(e=>console.error("Error:",e))},[]);let C=async t=>{P("Loading"),E("Getting data for "+t),t in r||(r[t]={},N(r)),console.log("Getting data for",t);let l=a.rpc,n={jsonrpc:"2.0",id:1,method:"abci_query",params:{path:"/custom/vstorage/data/published.priceFeed."+t+"_price_feed.latestRound"}},i=v(await h(l,n),t,e);for(let e in z(t),i[t].round in r[t]||(r[t][i[t].round]={},N(r)),n={jsonrpc:"2.0",id:1,method:"abci_query",params:{path:"/custom/vstorage/data/published.priceFeed."+t+"_price_feed"}},i=y(await h(l,n),t,i),a.oracleAddresses){let s=!1;a.oracleAddresses[e].oracleName in r[t][i[t].round]||(r[t][i[t].round][a.oracleAddresses[e].oracleName]={},N(r));let n=Number((await f(l+"/block")).result.block.header.height)-1;for(let c=n;!s;c--){let n={jsonrpc:"2.0",id:1,method:"abci_query",params:{path:"/custom/vstorage/data/published.wallet."+e+".current",height:String(c)}},o=S(await h(l,n),e,t,i,J,b);T(o.oracleInvitations),o.submission&&(s=!0,-1!=o.submission.roundId&&(r[t][o.submission.roundId][a.oracleAddresses[e].oracleName]=o.submission,r[t][o.submission.roundId]=x(r[t][o.submission.roundId]),N(r)))}}console.log("oracle submissions",r),P(""),s(i)};return(0,t.jsxs)("section",{className:"flex flex-col items-center justify-center gap-4 py-8 md:py-10",children:[A.length>0?(0,t.jsxs)("div",{className:"toast rounded-xl",children:[(0,t.jsxs)("div",{className:"flex mb-3",children:[(0,t.jsx)("p",{children:A}),(0,t.jsx)(n.c,{className:"m-auto ml-3"})]}),(0,t.jsx)("p",{className:"toastDesc",children:_})]}):null,(0,t.jsxs)(O.w,{className:"w-full",children:[(0,t.jsx)(w.u,{children:(0,t.jsx)("p",{className:"text-2xl p-4",children:"Feeds"})}),(0,t.jsxs)(I.G,{className:"pb-10",children:[(0,t.jsx)("div",{className:"flex px-4",children:Object.keys(e).map((e,s)=>(0,t.jsx)(m.z,{className:"m mr-5 p-4 rounded-xl",color:e==q?"primary":"default",onClick:()=>C(e),children:e},s))}),Object.keys(e).map((s,l)=>q==s&&0==A.length?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-4 pt-10",children:[(0,t.jsxs)("div",{className:"px-4 py-2 col-span-6",children:[(0,t.jsx)("p",{className:"text-lg",children:"Round"}),(0,t.jsx)("p",{className:"text-2xl",children:e[s].round})]}),(0,t.jsxs)("div",{className:"px-4 py-2 col-span-6",children:[(0,t.jsx)("p",{className:"text-lg",children:"Price"}),(0,t.jsxs)("p",{className:"text-2xl",children:["$",e[s].price.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"px-4 py-2 col-span-6",children:[(0,t.jsx)("p",{className:"text-lg",children:"Round Started At:"}),(0,t.jsx)("p",{className:"text-2xl",children:new Date(1e3*e[s].startedAt).toUTCString()})]}),(0,t.jsxs)("div",{className:"px-4 py-2 col-span-6",children:[(0,t.jsx)("p",{className:"text-lg",children:"Round Started By:"}),(0,t.jsx)("p",{className:"text-2xl",children:a.oracleAddresses[e[s].startedBy].oracleName})]})]}),(0,t.jsx)("div",{children:(0,t.jsxs)(i.b,{"aria-label":"Submissions",className:"pt-10",children:[(0,t.jsxs)(c.J,{children:[(0,t.jsx)(o.j,{children:"Oracle"}),(0,t.jsx)(o.j,{children:"Submitted Price"})]}),(0,t.jsx)(d.y,{children:Object.keys(r[s][e[s].round]).map((a,l)=>r[s][e[s].round][a].unitPrice?(0,t.jsxs)(u.g,{children:[(0,t.jsx)(p.X,{children:a}),(0,t.jsxs)(p.X,{children:["$",r[s][e[s].round][a].unitPrice]})]},l):(0,t.jsx)("div",{className:"hidden"}))})]})})]},s):null)]})]}),(0,t.jsxs)(O.w,{className:"w-full",children:[(0,t.jsx)(w.u,{children:(0,t.jsx)("p",{className:"text-2xl p-4",children:"Oracles"})}),(0,t.jsx)(I.G,{className:"pb-10",children:(0,t.jsx)("div",{className:"px-4",children:Object.keys(a.oracleAddresses).map((e,s)=>(0,t.jsxs)("div",{className:"pb-5",children:[(0,t.jsx)("p",{className:"text-primary ",children:String(a.oracleAddresses[e].oracleName)}),(0,t.jsx)("p",{className:"text-zinc-300",children:e})]},e))})})]})]})}}},function(e){e.O(0,[270,590,971,23,744],function(){return e(e.s=8875)}),_N_E=e.O()}]);